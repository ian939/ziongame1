<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ³ ê¼¬ë§ˆ ìš”ë¦¬ì‚¬ì˜ ë§›ìˆëŠ” ë ˆìŠ¤í† ë‘</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Jua', sans-serif;
            background-color: #fdf6e3;
            overflow-x: hidden;
        }
        .cute-shadow {
            box-shadow: 0 4px 0 rgba(0,0,0,0.1), 0 8px 20px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
        }
        .cute-shadow:active {
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
            transform: translateY(2px);
        }
        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-gentle {
            animation: bounce-gentle 2s infinite;
        }
        .clickable {
            cursor: pointer;
            user-select: none;
        }
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        // ğŸ”Š ì‚¬ìš´ë“œ íš¨ê³¼ ì‹œìŠ¤í…œ
        const SoundSystem = {
            audioContext: null,
            init() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }
            },
            playPop() { this.playTone(800, 'sine', 0.1); },
            playSuccess() { 
                this.playTone(523.25, 'sine', 0.4, 0); 
                this.playTone(659.25, 'sine', 0.4, 0.1); 
                this.playTone(783.99, 'sine', 0.4, 0.2); 
            },
            playEating() {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => this.playTone(300 + Math.random() * 200, 'square', 0.15), i * 300);
                }
            },
            playCoin() {
                this.init();
                const ctx = this.audioContext;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(1000, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1500, ctx.currentTime + 0.1);
                osc.type = 'triangle';
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.2);
            },
            playFail() {
                this.init();
                const ctx = this.audioContext;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(400, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.3);
                osc.type = 'sawtooth';
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.3);
            },
            playLevelUp() {
                [523.25, 587.33, 659.25, 783.99].forEach((freq, i) => {
                    setTimeout(() => this.playTone(freq, 'sine', 0.3), i * 150);
                });
            },
            playTone(freq, type, duration, delay = 0) {
                this.init();
                const ctx = this.audioContext;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = freq;
                osc.type = type;
                gain.gain.setValueAtTime(0.3, ctx.currentTime + delay);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + delay + duration);
                osc.start(ctx.currentTime + delay);
                osc.stop(ctx.currentTime + delay + duration);
            }
        };

        function getJosa(name, josa) {
            const lastChar = name.charAt(name.length - 1);
            const code = lastChar.charCodeAt(0) - 0xAC00;
            const hasFinalConsonant = code % 28 !== 0;
            if (josa === 'ì´/ê°€') return hasFinalConsonant ? 'ì´' : 'ê°€';
            if (josa === 'ì„/ë¥¼') return hasFinalConsonant ? 'ì„' : 'ë¥¼';
            if (josa === 'ì€/ëŠ”') return hasFinalConsonant ? 'ì€' : 'ëŠ”';
            return '';
        }

        const GAME_DATA = {
            ingredients: {
                apple: { id: 'apple', name: 'ì‚¬ê³¼', emoji: 'ğŸ', category: 'fruit', level: 1 },
                banana: { id: 'banana', name: 'ë°”ë‚˜ë‚˜', emoji: 'ğŸŒ', category: 'fruit', level: 1 },
                carrot: { id: 'carrot', name: 'ë‹¹ê·¼', emoji: 'ğŸ¥•', category: 'vegetable', level: 1 },
                tomato: { id: 'tomato', name: 'í† ë§ˆí† ', emoji: 'ğŸ…', category: 'vegetable', level: 1 },
                onion: { id: 'onion', name: 'ì–‘íŒŒ', emoji: 'ğŸ§…', category: 'vegetable', level: 1 },
                potato: { id: 'potato', name: 'ê°ì', emoji: 'ğŸ¥”', category: 'vegetable', level: 1 },
                milk: { id: 'milk', name: 'ìš°ìœ ', emoji: 'ğŸ¥›', category: 'dairy', level: 1 },
                egg: { id: 'egg', name: 'ê³„ë€', emoji: 'ğŸ¥š', category: 'protein', level: 1 },
                cheese: { id: 'cheese', name: 'ì¹˜ì¦ˆ', emoji: 'ğŸ§€', category: 'dairy', level: 1 },
                bread: { id: 'bread', name: 'ë¹µ', emoji: 'ğŸ', category: 'grain', level: 1 },
                strawberry: { id: 'strawberry', name: 'ë”¸ê¸°', emoji: 'ğŸ“', category: 'fruit', level: 1 },
                chocolate: { id: 'chocolate', name: 'ì´ˆì½œë¦¿', emoji: 'ğŸ«', category: 'sweets', level: 1 },
                cucumber: { id: 'cucumber', name: 'ì˜¤ì´', emoji: 'ğŸ¥’', category: 'vegetable', level: 2 },
                mushroom: { id: 'mushroom', name: 'ë²„ì„¯', emoji: 'ğŸ„', category: 'vegetable', level: 2 },
                bacon: { id: 'bacon', name: 'ë² ì´ì»¨', emoji: 'ğŸ¥“', category: 'protein', level: 2 },
                rice: { id: 'rice', name: 'ìŒ€', emoji: 'ğŸš', category: 'grain', level: 2 },
                noodle: { id: 'noodle', name: 'ë©´', emoji: 'ğŸœ', category: 'grain', level: 2 },
                chicken: { id: 'chicken', name: 'ë‹­ê³ ê¸°', emoji: 'ğŸ—', category: 'protein', level: 2 },
                lettuce: { id: 'lettuce', name: 'ìƒì¶”', emoji: 'ğŸ¥¬', category: 'vegetable', level: 2 },
                broccoli: { id: 'broccoli', name: 'ë¸Œë¡œì½œë¦¬', emoji: 'ğŸ¥¦', category: 'vegetable', level: 3 },
                corn: { id: 'corn', name: 'ì˜¥ìˆ˜ìˆ˜', emoji: 'ğŸŒ½', category: 'vegetable', level: 3 },
                pumpkin: { id: 'pumpkin', name: 'í˜¸ë°•', emoji: 'ğŸƒ', category: 'vegetable', level: 3 },
                pepper: { id: 'pepper', name: 'í”¼ë§', emoji: 'ğŸ«‘', category: 'vegetable', level: 3 },
                fish: { id: 'fish', name: 'ìƒì„ ', emoji: 'ğŸŸ', category: 'protein', level: 3 },
                shrimp: { id: 'shrimp', name: 'ìƒˆìš°', emoji: 'ğŸ¦', category: 'protein', level: 3 },
                beef: { id: 'beef', name: 'ì†Œê³ ê¸°', emoji: 'ğŸ¥©', category: 'protein', level: 3 },
                garlic: { id: 'garlic', name: 'ë§ˆëŠ˜', emoji: 'ğŸ§„', category: 'vegetable', level: 3 },
            },
            recipes: {
                strawberryJuice: { id: 'strawberryJuice', name: 'ë”¸ê¸° ì£¼ìŠ¤', emoji: 'ğŸ¥¤', price: 500, ingredients: ['strawberry', 'strawberry', 'milk'], cookingTool: 'bowl', description: 'ìƒí¼í•˜ê³  ë‹¬ì½¤í•œ ë¦¬ì–¼ ë”¸ê¸° ì£¼ìŠ¤', level: 1 },
                tomatoJuice: { id: 'tomatoJuice', name: 'í† ë§ˆí†  ì£¼ìŠ¤', emoji: 'ğŸ¥¤', price: 500, ingredients: ['tomato', 'tomato'], cookingTool: 'bowl', description: 'ê±´ê°•í•˜ê³  ì‹œì›í•œ í† ë§ˆí†  ì£¼ìŠ¤', level: 1 },
                tomatoSoup: { id: 'tomatoSoup', name: 'í† ë§ˆí†  ìˆ˜í”„', emoji: 'ğŸ²', price: 500, ingredients: ['tomato', 'tomato', 'onion'], cookingTool: 'pot', description: 'ë¹¨ê°„ í† ë§ˆí† ë¡œ ë§Œë“  ë”°ëœ»í•œ ìˆ˜í”„', level: 1 },
                friedEgg: { id: 'friedEgg', name: 'ê³„ë€ í›„ë¼ì´', emoji: 'ğŸ³', price: 300, ingredients: ['egg', 'egg'], cookingTool: 'pan', description: 'ë…¸ë¦‡ë…¸ë¦‡ ê³„ë€ í›„ë¼ì´', level: 1 },
                carrotSalad: { id: 'carrotSalad', name: 'ë‹¹ê·¼ ìƒëŸ¬ë“œ', emoji: 'ğŸ¥—', price: 400, ingredients: ['carrot', 'carrot', 'tomato'], cookingTool: 'bowl', description: 'ì‹ ì„ í•œ ì±„ì†Œ ìƒëŸ¬ë“œ', level: 1 },
                cheeseSandwich: { id: 'cheeseSandwich', name: 'ì¹˜ì¦ˆ ìƒŒë“œìœ„ì¹˜', emoji: 'ğŸ¥ª', price: 600, ingredients: ['bread', 'cheese', 'tomato'], cookingTool: 'pan', description: 'ê³ ì†Œí•œ ì¹˜ì¦ˆ ìƒŒë“œìœ„ì¹˜', level: 1 },
                applePie: { id: 'applePie', name: 'ì‚¬ê³¼ íŒŒì´', emoji: 'ğŸ¥§', price: 700, ingredients: ['apple', 'apple', 'apple'], cookingTool: 'pot', description: 'ë‹¬ì½¤í•œ ì‚¬ê³¼ íŒŒì´', level: 1 },
                mushroomSoup: { id: 'mushroomSoup', name: 'ë²„ì„¯ í¬ë¦¼ ìˆ˜í”„', emoji: 'ğŸ„', price: 800, ingredients: ['mushroom', 'mushroom', 'milk', 'onion'], cookingTool: 'pot', description: 'ë¶€ë“œëŸ¬ìš´ ë²„ì„¯ í¬ë¦¼ ìˆ˜í”„', level: 2 },
                baconEggToast: { id: 'baconEggToast', name: 'ë² ì´ì»¨ ì—ê·¸ í† ìŠ¤íŠ¸', emoji: 'ğŸ', price: 900, ingredients: ['bread', 'bacon', 'egg', 'cheese'], cookingTool: 'pan', description: 'ë“ ë“ í•œ ë² ì´ì»¨ ì—ê·¸ í† ìŠ¤íŠ¸', level: 2 },
                friedRice: { id: 'friedRice', name: 'ë³¶ìŒë°¥', emoji: 'ğŸ³', price: 700, ingredients: ['rice', 'egg', 'carrot', 'onion'], cookingTool: 'pan', description: 'ë§›ìˆëŠ” ë³¶ìŒë°¥', level: 2 },
                vegetableNoodle: { id: 'vegetableNoodle', name: 'ì•¼ì±„ ë¼ë©´', emoji: 'ğŸœ', price: 600, ingredients: ['noodle', 'cucumber', 'carrot', 'egg'], cookingTool: 'pot', description: 'ê±´ê°•í•œ ì•¼ì±„ ë¼ë©´', level: 2 },
                potatoSalad: { id: 'potatoSalad', name: 'ê°ì ìƒëŸ¬ë“œ', emoji: 'ğŸ¥”', price: 500, ingredients: ['potato', 'egg', 'cucumber', 'carrot'], cookingTool: 'bowl', description: 'ê³ ì†Œí•œ ê°ì ìƒëŸ¬ë“œ', level: 2 },
                chickenSalad: { id: 'chickenSalad', name: 'ì¹˜í‚¨ ìƒëŸ¬ë“œ', emoji: 'ğŸ¥—', price: 800, ingredients: ['chicken', 'lettuce', 'tomato', 'cucumber'], cookingTool: 'bowl', description: 'ê±´ê°•í•˜ê³  ë“ ë“ í•œ ë‹­ê°€ìŠ´ì‚´ ìƒëŸ¬ë“œ', level: 2 },
                chocolateCake: { id: 'chocolateCake', name: 'ì´ˆì½” ì¼€ì´í¬', emoji: 'ğŸ‚', price: 900, ingredients: ['bread', 'chocolate', 'egg', 'milk'], cookingTool: 'pan', description: 'ë‹¬ì½¤í•œ ì´ˆì½œë¦¿ì´ ê°€ë“í•œ ì¼€ì´í¬', level: 2 },
                seafoodPasta: { id: 'seafoodPasta', name: 'í•´ì‚°ë¬¼ íŒŒìŠ¤íƒ€', emoji: 'ğŸ', price: 1200, ingredients: ['noodle', 'shrimp', 'fish', 'tomato', 'onion'], cookingTool: 'pan', description: 'í’ì„±í•œ í•´ì‚°ë¬¼ íŒŒìŠ¤íƒ€', level: 3 },
                grilledFish: { id: 'grilledFish', name: 'ìƒì„  êµ¬ì´', emoji: 'ğŸŸ', price: 1000, ingredients: ['fish', 'fish', 'pepper', 'broccoli'], cookingTool: 'pan', description: 'ì‹ ì„ í•œ ìƒì„  êµ¬ì´', level: 3 },
                cornSoup: { id: 'cornSoup', name: 'ì˜¥ìˆ˜ìˆ˜ í¬ë¦¼ ìˆ˜í”„', emoji: 'ğŸŒ½', price: 900, ingredients: ['corn', 'corn', 'milk', 'potato'], cookingTool: 'pot', description: 'ë‹¬ì½¤í•œ ì˜¥ìˆ˜ìˆ˜ ìˆ˜í”„', level: 3 },
                pumpkinRisotto: { id: 'pumpkinRisotto', name: 'í˜¸ë°• ë¦¬ì¡°ë˜', emoji: 'ğŸƒ', price: 1100, ingredients: ['rice', 'pumpkin', 'cheese', 'mushroom', 'onion'], cookingTool: 'pot', description: 'ë¶€ë“œëŸ¬ìš´ í˜¸ë°• ë¦¬ì¡°ë˜', level: 3 },
                shrimpSalad: { id: 'shrimpSalad', name: 'ìƒˆìš° ìƒëŸ¬ë“œ', emoji: 'ğŸ¦', price: 800, ingredients: ['shrimp', 'broccoli', 'corn', 'tomato'], cookingTool: 'bowl', description: 'ì‹ ì„ í•œ ìƒˆìš° ìƒëŸ¬ë“œ', level: 3 },
                vegetableStew: { id: 'vegetableStew', name: 'ì•¼ì±„ ìŠ¤íŠœ', emoji: 'ğŸ¥˜', price: 1000, ingredients: ['potato', 'carrot', 'broccoli', 'pumpkin', 'onion'], cookingTool: 'pot', description: 'í‘¸ì§í•œ ì•¼ì±„ ìŠ¤íŠœ', level: 3 },
                garlicSteak: { id: 'garlicSteak', name: 'ë§ˆëŠ˜ ìŠ¤í…Œì´í¬', emoji: 'ğŸ¥©', price: 1500, ingredients: ['beef', 'garlic', 'mushroom', 'pepper', 'onion'], cookingTool: 'pan', description: 'ë§ˆëŠ˜ í–¥ì´ ê°€ë“í•œ ìµœê³ ê¸‰ ì†Œê³ ê¸° ìŠ¤í…Œì´í¬', level: 3 },
                hamburger: { id: 'hamburger', name: 'ì¹˜ì¦ˆ í–„ë²„ê±°', emoji: 'ğŸ”', price: 1300, ingredients: ['bread', 'beef', 'cheese', 'lettuce', 'tomato'], cookingTool: 'pan', description: 'íŒ¨í‹°ì™€ ì•¼ì±„ê°€ ë“¬ë¿ ë“¤ì–´ê°„ ìˆ˜ì œ ë²„ê±°', level: 3 },
                jionSpecial: { id: 'jionSpecial', name: 'ì§€ì˜¨ì´ì˜ ìŠ¤í˜ì…œ ìš”ë¦¬', emoji: 'ğŸŒŸ', price: 2000, ingredients: ['shrimp', 'fish', 'bacon', 'cheese', 'broccoli', 'corn', 'mushroom', 'tomato'], cookingTool: 'pan', description: 'ìµœê³ ê¸‰ ì¬ë£Œë¡œ ë§Œë“  íŠ¹ë³„í•œ ìš”ë¦¬', level: 3, special: true },
                freestyle: { id: 'freestyle', name: 'ì¹œêµ¬ë¥¼ ìœ„í•œ íŠ¹ë³„ ìš”ë¦¬', emoji: 'ğŸ', price: 0, ingredients: [], cookingTool: 'any', description: 'ì¹œêµ¬ê°€ ì¢‹ì•„í•˜ëŠ” ì¬ë£Œë¥¼ ë“¬ë¿ ë„£ì–´ì£¼ì„¸ìš”!', level: 1, isFreestyle: true }
            },
            animals: [
                { id: 'dog', emoji: 'ğŸ¶', name: 'ê°•ì•„ì§€', color: '#FFD700' },
                { id: 'cat', emoji: 'ğŸ±', name: 'ê³ ì–‘ì´', color: '#FFB6C1' },
                { id: 'bear', emoji: 'ğŸ»', name: 'ê³°ëŒì´', color: '#DEB887' },
                { id: 'rabbit', emoji: 'ğŸ°', name: 'í† ë¼', color: '#E6E6FA' },
                { id: 'fox', emoji: 'ğŸ¦Š', name: 'ì—¬ìš°', color: '#FF8C69' },
                { id: 'panda', emoji: 'ğŸ¼', name: 'íŒë‹¤', color: '#F0F0F0' },
                { id: 'penguin', emoji: 'ğŸ§', name: 'í­ê·„', color: '#B0E0E6' },
                { id: 'tiger', emoji: 'ğŸ¯', name: 'í˜¸ë‘ì´', color: '#FFA500' },
                { id: 'lion', emoji: 'ğŸ¦', name: 'ì‚¬ì', color: '#F4A460' },
                { id: 'koala', emoji: 'ğŸ¨', name: 'ì½”ì•Œë¼', color: '#D3D3D3' },
                { id: 'frog', emoji: 'ğŸ¸', name: 'ê°œêµ¬ë¦¬', color: '#98FB98' },
                { id: 'chick', emoji: 'ğŸ¥', name: 'ë³‘ì•„ë¦¬', color: '#FFFFE0' },
                { id: 'corgi', emoji: 'ğŸ•', name: 'ì„¤ê¸°', color: '#FFE4B5', special: 'jion' },
                { id: 'beetle', emoji: 'ğŸª²', name: 'ì¥ìˆ˜í’ë…ì´', color: '#8B4513' },
                { id: 'wasp', emoji: 'ğŸ', name: 'ì¥ìˆ˜ë§ë²Œ', color: '#FFD700' },
                { id: 'mantis', emoji: 'ğŸ¦—', name: 'ì‚¬ë§ˆê·€', color: '#90EE90' },
                { id: 'dragonfly', emoji: 'ğŸ¦Ÿ', name: 'ì ìë¦¬', color: '#87CEEB' },
                { id: 'junsu', emoji: 'ğŸ‘¦', name: 'ì¤€ìˆ˜', color: '#A3D8FF', type: 'friend', desc: 'ë§ë²Œ ë°•ì‚¬' },
                { id: 'minjun', emoji: 'ğŸ§‘', name: 'ë¯¼ì¤€', color: '#C3FFD8', type: 'friend', desc: 'ê³¼í•™ ëŒ€ì¥' },
                { id: 'taehee', emoji: 'ğŸ‘§', name: 'íƒœí¬', color: '#FFC3C3', type: 'friend', desc: 'ë³´ë“œê²Œì„ ê³µì£¼' },
            ],
            money: [
                { value: 1000, emoji: 'ğŸ’µ', name: 'ì²œì›' },
                { value: 500, emoji: 'ğŸ’´', name: 'ì˜¤ë°±ì›' },
                { value: 100, emoji: 'ğŸª™', name: 'ë°±ì›' },
            ]
        };

        const COOKING_TOOLS = {
            pot: { name: 'ëƒ„ë¹„', emoji: 'ğŸ²', color: 'bg-red-100' },
            pan: { name: 'í›„ë¼ì´íŒ¬', emoji: 'ğŸ³', color: 'bg-yellow-100' },
            bowl: { name: 'ê·¸ë¦‡', emoji: 'ğŸ¥—', color: 'bg-green-100' }
        };

// ë©”ì¸ ê²Œì„ ì»´í¬ë„ŒíŠ¸
        function RestaurantGame() {
            const [gameStage, setGameStage] = useState('welcome'); 
            const [lastStage, setLastStage] = useState('welcome'); // [NEW] ì§ì „ í™”ë©´ ê¸°ì–µí•˜ê¸°
            
            const [level, setLevel] = useState(1);
            const [score, setScore] = useState(1000);
            const [currentAnimal, setCurrentAnimal] = useState(null);
            const [currentRecipe, setCurrentRecipe] = useState(null);
            const [currentOrders, setCurrentOrders] = useState([]); 
            const [completedOrders, setCompletedOrders] = useState([]);
            const [currentOrderIndex, setCurrentOrderIndex] = useState(0); 
            const [cookingPot, setCookingPot] = useState([]); 
            const [customerPayment, setCustomerPayment] = useState(0); 
            const [selectedChange, setSelectedChange] = useState([]); 
            const [showFeedback, setShowFeedback] = useState(false);
            const [feedbackMessage, setFeedbackMessage] = useState('');
            const [failedDish, setFailedDish] = useState(null); 
            
            const [stock, setStock] = useState(() => {
                const initialStock = {};
                Object.keys(GAME_DATA.ingredients).forEach(key => initialStock[key] = 10);
                return initialStock;
            });

            const [cart, setCart] = useState({});
            const [expenseAmount, setExpenseAmount] = useState(0);
            const [emergencyItem, setEmergencyItem] = useState(null);

            // ë°ì´í„° ë¡œë“œ
            useEffect(() => {
                const savedData = localStorage.getItem('restaurantGameState');
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        if (data.gameStage && data.gameStage !== 'welcome') {
                            setGameStage(data.gameStage);
                            // lastStageë„ ë³µêµ¬
                            setLastStage(data.lastStage || 'welcome');
                            
                            setLevel(data.level || 1);
                            setScore(data.score || 1000);
                            setCurrentAnimal(data.currentAnimal || null);
                            setCurrentRecipe(data.currentRecipe || null);
                            setCurrentOrders(data.currentOrders || []);
                            setCompletedOrders(data.completedOrders || []);
                            setCurrentOrderIndex(data.currentOrderIndex || 0);
                            setCookingPot(data.cookingPot || []);
                            setCustomerPayment(data.customerPayment || 0);
                            setSelectedChange(data.selectedChange || []);
                            setFailedDish(data.failedDish || null);
                            if(data.stock) setStock(data.stock);
                        }
                    } catch (error) { console.error(error); }
                }
            }, []);
            
            // ë°ì´í„° ì €ì¥
            useEffect(() => {
                if (gameStage !== 'welcome') {
                    const saveData = { 
                        gameStage, lastStage, // lastStage ì €ì¥
                        level, score, currentAnimal, currentRecipe, 
                        currentOrders, completedOrders, currentOrderIndex, cookingPot, 
                        customerPayment, selectedChange, failedDish, stock 
                    };
                    localStorage.setItem('restaurantGameState', JSON.stringify(saveData));
                }
            }, [gameStage, lastStage, level, score, currentAnimal, currentRecipe, currentOrders, completedOrders, currentOrderIndex, cookingPot, customerPayment, selectedChange, failedDish, stock]);
            
            const startGame = (startLevel = 1) => {
                setLevel(startLevel);
                generateOrder();
                setGameStage('order');
                // ìƒˆ ê²Œì„ì„ ì‹œì‘í•  ë•Œë§Œ ì ìˆ˜ ì´ˆê¸°í™”
                if (startLevel === 4) setScore(50000);
                else if (startLevel === 3) setScore(10000);
                else if (startLevel === 2) setScore(3000);
                else setScore(1000);
            };
            
            const generateOrder = () => {
                const isFriendVisitor = Math.random() < 0.2; 
                let randomCustomer;
                if (isFriendVisitor) {
                    const friends = GAME_DATA.animals.filter(a => a.type === 'friend');
                    randomCustomer = friends[Math.floor(Math.random() * friends.length)];
                    const specialRecipe = GAME_DATA.recipes.freestyle;
                    setCurrentAnimal(randomCustomer);
                    setCurrentRecipe(specialRecipe);
                    setCurrentOrders([specialRecipe]);
                } else {
                    const animals = GAME_DATA.animals.filter(a => a.type !== 'friend');
                    randomCustomer = animals[Math.floor(Math.random() * animals.length)];
                    
                    if (level === 1) {
                        const level1Recipes = Object.values(GAME_DATA.recipes).filter(r => r.level === 1 && !r.isFreestyle);
                        const randomRecipe = level1Recipes[Math.floor(Math.random() * level1Recipes.length)];
                        setCurrentAnimal(randomCustomer);
                        setCurrentRecipe(randomRecipe);
                        setCurrentOrders([randomRecipe]);
                    } else if (level === 2) {
                        const level2Recipes = Object.values(GAME_DATA.recipes).filter(r => r.level === 2 && !r.isFreestyle);
                        const recipe1 = level2Recipes[Math.floor(Math.random() * level2Recipes.length)];
                        let recipe2 = level2Recipes[Math.floor(Math.random() * level2Recipes.length)];
                        while (recipe2.id === recipe1.id && level2Recipes.length > 1) recipe2 = level2Recipes[Math.floor(Math.random() * level2Recipes.length)];
                        setCurrentAnimal(randomCustomer);
                        setCurrentRecipe(recipe1);
                        setCurrentOrders([recipe1, recipe2]);
                    } else {
                        if (randomCustomer.special === 'jion') {
                           const specialRecipe = GAME_DATA.recipes.jionSpecial;
                           setCurrentAnimal(randomCustomer);
                           setCurrentRecipe(specialRecipe);
                           setCurrentOrders([specialRecipe]);
                        } else {
                           let availableRecipes;
                           if (level === 3) availableRecipes = Object.values(GAME_DATA.recipes).filter(r => r.level === 3 && !r.isFreestyle && !r.special);
                           else availableRecipes = Object.values(GAME_DATA.recipes).filter(r => !r.isFreestyle && !r.special);
                           
                           const recipe1 = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
                           let recipe2 = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
                           let recipe3 = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
                           
                           if (availableRecipes.length > 2) {
                               while (recipe2.id === recipe1.id) recipe2 = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
                               while (recipe3.id === recipe1.id || recipe3.id === recipe2.id) recipe3 = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
                           }
                           setCurrentAnimal(randomCustomer);
                           setCurrentRecipe(recipe1);
                           setCurrentOrders([recipe1, recipe2, recipe3]);
                        }
                    }
                }
                setCompletedOrders([]);
                setCurrentOrderIndex(0);
                setCookingPot([]);
                setCustomerPayment(0);
                setSelectedChange([]);
                setFailedDish(null);
            };
            
            const viewRecipe = () => setGameStage('recipe');
            const startCooking = () => setGameStage('cooking');
            
            // [ìˆ˜ì •ë¨] ë§ˆíŠ¸ë¡œ ì´ë™ (í˜„ì¬ ìœ„ì¹˜ ê¸°ì–µ)
            const goToMarket = () => { 
                setCart({}); 
                setLastStage(gameStage); // í˜„ì¬ ìŠ¤í…Œì´ì§€ë¥¼ ê¸°ì–µí•´ë‘ 
                setGameStage('market'); 
            };
            
            const addIngredient = (ingredientId) => {
                if (stock[ingredientId] > 0) {
                    SoundSystem.playPop();
                    setStock(prev => ({ ...prev, [ingredientId]: prev[ingredientId] - 1 }));
                    setCookingPot([...cookingPot, ingredientId]);
                } else {
                    SoundSystem.playFail();
                    setEmergencyItem(GAME_DATA.ingredients[ingredientId]);
                }
            };
            
            const handleEmergencyBuy = () => {
                if (score >= 200) {
                    SoundSystem.playCoin();
                    setScore(prev => prev - 200);
                    setStock(prev => ({ ...prev, [emergencyItem.id]: prev[emergencyItem.id] + 1 }));
                    setEmergencyItem(null);
                    showFeedbackMsg(`ğŸ“¦ ${emergencyItem.name} 1ê°œ ê¸‰í•˜ê²Œ êµ¬ë§¤ ì™„ë£Œ! (-200ì›)`, true);
                } else {
                    showFeedbackMsg("ëˆì´ ë¶€ì¡±í•´ì„œ ì‚´ ìˆ˜ ì—†ì–´ìš”! ğŸ˜­", false);
                }
            };

            const removeIngredient = (index) => {
                const itemToRemove = cookingPot[index];
                setCookingPot(cookingPot.filter((_, i) => i !== index));
                setStock(prev => ({ ...prev, [itemToRemove]: prev[itemToRemove] + 1 }));
            };
            
            const startCookingDish = () => {
                if (cookingPot.length === 0) {
                    showFeedbackMsg('ğŸ¤” ì¬ë£Œë¥¼ ë¨¼ì € ë„£ì–´ì£¼ì„¸ìš”!', false);
                    return;
                }
                if (currentRecipe && currentRecipe.isFreestyle) {
                    SoundSystem.playSuccess();
                    const customPrice = 500 + (cookingPot.length * 300);
                    const ingredientNames = cookingPot.map(id => GAME_DATA.ingredients[id].name);
                    const uniqueNames = [...new Set(ingredientNames)];
                    let customName = uniqueNames.length === 1 ? `ê°€ë“ì°¬ ${uniqueNames[0]} ìš”ë¦¬` : uniqueNames.length === 2 ? `${uniqueNames[0]}ì™€ ${uniqueNames[1]}ì˜ ë§Œë‚¨` : `${uniqueNames[0]} ë“¬ë¿ ìŠ¤í˜ì…œ ìš”ë¦¬`;

                    const finishedDish = { ...currentRecipe, name: customName, price: customPrice, emoji: 'ğŸ²', description: `ì§€ì˜¨ì´ê°€ ${currentAnimal.name}ë¥¼ ìœ„í•´ ë§Œë“  ìš”ë¦¬!` };
                    const newOrders = [...currentOrders];
                    newOrders[currentOrderIndex] = finishedDish;
                    setCurrentOrders(newOrders);
                    setCurrentRecipe(finishedDish); 
                    setCompletedOrders([...completedOrders, finishedDish]);
                    setTimeout(() => setGameStage('serving'), 1000);
                    return;
                }
                const recipeSorted = [...currentRecipe.ingredients].sort();
                const potSorted = [...cookingPot].sort();
                const isCorrect = JSON.stringify(recipeSorted) === JSON.stringify(potSorted);

                if (isCorrect) {
                    SoundSystem.playSuccess();
                    setFailedDish(null);
                    setCompletedOrders([...completedOrders, currentRecipe]);
                    const nextIndex = currentOrderIndex + 1;
                    if (nextIndex < currentOrders.length) {
                        setTimeout(() => {
                            setCurrentOrderIndex(nextIndex);
                            setCurrentRecipe(currentOrders[nextIndex]);
                            setCookingPot([]);
                            setGameStage('cooking');
                            showFeedbackMsg(`ğŸ‰ ${currentRecipe.name} ì™„ì„±! ë‹¤ìŒ ìš”ë¦¬ ê³ ê³ !`, true);
                        }, 1000);
                    } else {
                        setTimeout(() => setGameStage('serving'), 1000);
                    }
                } else {
                    SoundSystem.playFail();
                    const names = cookingPot.map(id => GAME_DATA.ingredients[id].name);
                    const weirdName = [`${names[0]}ë§›?`, `ì´ìƒí•œ ${names[0]} ìš”ë¦¬`, `íƒ„ ${names[0]}`][Math.floor(Math.random()*3)];
                    setFailedDish({ name: weirdName, ingredients: cookingPot });
                    setTimeout(() => setGameStage('failed'), 1000);
                }
            };
            
            const finishServing = () => {
                const totalPrice = currentOrders.reduce((sum, recipe) => sum + recipe.price, 0);
                const isSpecialGuest = ['beetle', 'wasp', 'penguin'].includes(currentAnimal.id);
                const possiblePayments = isSpecialGuest 
                    ? [totalPrice + 1000, totalPrice + 2000, Math.ceil((totalPrice + 1000) / 1000) * 1000]
                    : [totalPrice + 100, totalPrice + 500, Math.ceil(totalPrice / 1000) * 1000];
                setCustomerPayment(possiblePayments[Math.floor(Math.random() * possiblePayments.length)]);
                setGameStage('payment');
            };
            
            const selectChangeMoney = (money) => { SoundSystem.playCoin(); setSelectedChange([...selectedChange, money]); };
            const removeChangeMoney = (index) => { setSelectedChange(selectedChange.filter((_, i) => i !== index)); };
            
            const checkChange = () => {
                const totalMoney = selectedChange.reduce((sum, money) => sum + money.value, 0);
                const totalPrice = currentOrders.reduce((sum, recipe) => sum + recipe.price, 0);
                if (totalMoney === totalPrice) {
                    SoundSystem.playSuccess();
                    const newScore = score + totalPrice;
                    setScore(newScore);
                    if (newScore >= 50000 && level === 3) { SoundSystem.playLevelUp(); setGameStage('levelup'); }
                    else if (newScore >= 10000 && level === 2) { SoundSystem.playLevelUp(); setGameStage('levelup'); }
                    else if (newScore >= 3000 && level === 1) { SoundSystem.playLevelUp(); setGameStage('levelup'); }
                    else { setGameStage('result'); }
                } else if (totalMoney < totalPrice) showFeedbackMsg(`ğŸ’° ${totalPrice - totalMoney}ì›ì´ ë¶€ì¡±í•´ìš”!`, false);
                else showFeedbackMsg(`ğŸ’° ${totalMoney - totalPrice}ì›ì´ ë„˜ì—ˆì–´ìš”!`, false);
            };

            const checkExpense = () => {
                const totalMoney = selectedChange.reduce((sum, money) => sum + money.value, 0);
                if (totalMoney === expenseAmount) {
                    SoundSystem.playCoin();
                    setScore(score - expenseAmount);
                    const newStock = { ...stock };
                    Object.entries(cart).forEach(([id, qty]) => newStock[id] = (newStock[id] || 0) + qty);
                    setStock(newStock);
                    showFeedbackMsg('ğŸ›’ ì¥ë³´ê¸° ì™„ë£Œ! ëƒ‰ì¥ê³ ê°€ ë¹µë¹µí•´ìš”!', true);
                    
                    // [ìˆ˜ì •ë¨] êµ¬ë§¤ í›„ ì›ë˜ ìˆë˜ í™”ë©´ìœ¼ë¡œ ë³µê·€
                    setGameStage(lastStage); 
                } else if (totalMoney < expenseAmount) showFeedbackMsg(`ğŸ’° ëˆì´ ë¶€ì¡±í•´ìš”! ${expenseAmount}ì›ì„ ë§ì¶°ì£¼ì„¸ìš”.`, false);
                else showFeedbackMsg(`ğŸ’° ëˆì„ ë„ˆë¬´ ë§ì´ ëƒˆì–´ìš”!`, false);
            };
            
            const showFeedbackMsg = (message, isSuccess) => {
                setFeedbackMessage(message);
                setShowFeedback(true);
                setTimeout(() => setShowFeedback(false), 2500);
            };
            
            const nextRound = () => { generateOrder(); setGameStage('order'); };
            const handleSave = () => { SoundSystem.playPop(); showFeedbackMsg('ğŸ’¾ ê²Œì„ì´ ì €ì¥ë˜ì—ˆì–´ìš”!', true); };
            const handleReset = () => { if (window.confirm('ğŸ”„ ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”?')) { localStorage.removeItem('restaurantGameState'); window.location.reload(); } };
            
            return (
                <div className="min-h-screen p-4 md:p-8">
                    <Header level={level} score={score} onSave={handleSave} onReset={handleReset} onGoToMarket={goToMarket} gameStage={gameStage} />
                    <AnimatePresence>
                        {showFeedback && <FeedbackMessage message={feedbackMessage} />}
                        {emergencyItem && <EmergencyModal item={emergencyItem} onBuy={handleEmergencyBuy} onCancel={() => setEmergencyItem(null)} />}
                    </AnimatePresence>
                    <div className="max-w-6xl mx-auto">
                        {gameStage === 'welcome' && <WelcomeScreen onStart={startGame} onGoToMarket={goToMarket} />}
                        {gameStage === 'order' && <OrderScreen animal={currentAnimal} recipe={currentRecipe} orders={currentOrders} level={level} onViewRecipe={viewRecipe} />}
                        {gameStage === 'recipe' && <RecipeScreen recipe={currentRecipe} orders={currentOrders} level={level} onStartCooking={startCooking} />}
                        {gameStage === 'cooking' && <CookingScreen recipe={currentRecipe} orders={currentOrders} completedOrders={completedOrders} currentOrderIndex={currentOrderIndex} cookingPot={cookingPot} level={level} stock={stock} onAddIngredient={addIngredient} onRemoveIngredient={removeIngredient} onStartCooking={startCookingDish} />}
                        {gameStage === 'failed' && <FailedScreen failedDish={failedDish} onRetry={() => { setCookingPot([]); setGameStage('cooking'); }} />}
                        {gameStage === 'serving' && <ServingScreen animal={currentAnimal} recipe={currentRecipe} onFinish={finishServing} />}
                        {gameStage === 'payment' && <PaymentScreen recipe={currentRecipe} orders={currentOrders} customerPayment={customerPayment} selectedChange={selectedChange} onSelectMoney={selectChangeMoney} onRemoveMoney={removeChangeMoney} onCheckChange={checkChange} />}
                        
                        {/* [ìˆ˜ì •ë¨] ë§ˆíŠ¸ í™”ë©´: ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ lastStageë¡œ ì´ë™ */}
                        {gameStage === 'market' && <MarketScreen stock={stock} score={score} cart={cart} setCart={setCart} onCheckout={(total) => { setExpenseAmount(total); setSelectedChange([]); setGameStage('expense'); }} onBack={() => setGameStage(lastStage)} />}
                        
                        {gameStage === 'expense' && <ExpenseScreen amount={expenseAmount} selectedChange={selectedChange} onSelectMoney={selectChangeMoney} onRemoveMoney={removeChangeMoney} onCheckExpense={checkExpense} />}
                        {gameStage === 'levelup' && <LevelUpScreen currentLevel={level} newLevel={level + 1} onContinue={() => { setLevel(level + 1); setGameStage('result'); }} />}
                        {gameStage === 'result' && <ResultScreen animal={currentAnimal} recipe={currentRecipe} orders={currentOrders} score={score} onNextRound={nextRound} />}
                    </div>
                </div>
            );
        }

        // --- í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤ ---
        
        function Header({ level, score, onSave, onReset, onGoToMarket, gameStage }) {
            const levelNames = { 1: 'ìˆ˜ìŠµ ìš”ë¦¬ì‚¬', 2: 'ìš”ë¦¬ì‚¬', 3: 'ì „ë¬¸ ìš”ë¦¬ì‚¬', 4: 'ì „ë¬¸ ê²½ì˜ì¸' };
            const showMarketBtn = ['welcome', 'order'].includes(gameStage);
            return (
                <motion.div initial={{ y: -50, opacity: 0 }} animate={{ y: 0, opacity: 1 }} className="text-center mb-8">
                    <h1 className="text-4xl md:text-6xl font-bold text-pink-600 mb-2">ğŸ³ ê¼¬ë§ˆ ìš”ë¦¬ì‚¬ì˜ ë§›ìˆëŠ” ë ˆìŠ¤í† ë‘</h1>
                    <div className="flex justify-center items-center gap-4 flex-wrap">
                        <div className="inline-block bg-white px-6 py-3 rounded-full cute-shadow"><span className="text-2xl md:text-3xl font-bold text-purple-600">â­ {levelNames[level]}</span></div>
                        <div className="inline-block bg-white px-6 py-3 rounded-full cute-shadow"><span className="text-2xl md:text-3xl font-bold text-green-600">ğŸ’° {score}ì›</span></div>
                        {showMarketBtn && <motion.button whileHover={{ scale: 1.1 }} whileTap={{ scale: 0.9 }} onClick={onGoToMarket} className="bg-yellow-400 text-white px-5 py-3 rounded-full cute-shadow text-xl font-bold hover:bg-yellow-500 transition-colors">ğŸ›’ ì¥ë³´ê¸°</motion.button>}
                        <motion.button whileHover={{ scale: 1.1 }} whileTap={{ scale: 0.9 }} onClick={onSave} className="bg-blue-500 text-white px-5 py-3 rounded-full cute-shadow text-xl font-bold hover:bg-blue-600 transition-colors">ğŸ’¾ ì €ì¥</motion.button>
                        <motion.button whileHover={{ scale: 1.1 }} whileTap={{ scale: 0.9 }} onClick={onReset} className="bg-red-500 text-white px-5 py-3 rounded-full cute-shadow text-xl font-bold hover:bg-red-600 transition-colors">ğŸ”„ ì´ˆê¸°í™”</motion.button>
                    </div>
                </motion.div>
            );
        }

        function WelcomeScreen({ onStart, onGoToMarket }) {
            return (
                <motion.div initial={{ scale: 0.8, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="text-center py-12">
                    <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-2xl mx-auto">
                        <div className="text-8xl mb-6 animate-bounce-gentle">ğŸ§‘â€ğŸ³</div>
                        <h2 className="text-3xl md:text-5xl font-bold text-gray-800 mb-4">ë§›ìˆëŠ” ë ˆìŠ¤í† ë‘ì—<br/>ì˜¤ì‹  ê±¸ í™˜ì˜í•´ìš”!</h2>
                        <div className="flex justify-center mb-8"><button onClick={onGoToMarket} className="bg-yellow-100 border-4 border-yellow-300 px-6 py-3 rounded-2xl text-xl font-bold text-yellow-800 hover:bg-yellow-200 transition-colors">ğŸ›’ ëƒ‰ì¥ê³  ì±„ìš°ëŸ¬ ë§ˆíŠ¸ ê°€ê¸°</button></div>
                        <div className="space-y-4">
                            <button onClick={() => { SoundSystem.playPop(); onStart(1); }} className="w-full bg-gradient-to-r from-green-400 to-blue-400 text-white text-2xl md:text-3xl font-bold px-12 py-6 rounded-full hover:scale-105 transition-transform cute-shadow">â­ ìˆ˜ìŠµìš”ë¦¬ì‚¬ë¡œ ì‹œì‘í•˜ê¸°</button>
                            <button onClick={() => { SoundSystem.playPop(); onStart(2); }} className="w-full bg-gradient-to-r from-purple-400 to-pink-400 text-white text-2xl md:text-3xl font-bold px-12 py-6 rounded-full hover:scale-105 transition-transform cute-shadow">ğŸ‘‘ ìš”ë¦¬ì‚¬ë¡œ ì‹œì‘í•˜ê¸°</button>
                            <button onClick={() => { SoundSystem.playPop(); onStart(3); }} className="w-full bg-gradient-to-r from-orange-400 to-red-400 text-white text-2xl md:text-3xl font-bold px-12 py-6 rounded-full hover:scale-105 transition-transform cute-shadow">ğŸŒŸ ì „ë¬¸ìš”ë¦¬ì‚¬ë¡œ ì‹œì‘í•˜ê¸°</button>
                        </div>
                    </div>
                </motion.div>
            );
        }

        function OrderScreen({ animal, recipe, orders, level, onViewRecipe }) {
            if (!animal || !recipe) return null;
            const displayOrders = (orders && orders.length > 0) ? orders : [recipe];
            const totalPrice = displayOrders.reduce((sum, r) => sum + r.price, 0);
            return (
                <motion.div initial={{ x: -100, opacity: 0 }} animate={{ x: 0, opacity: 1 }} className="py-8">
                    <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-3xl mx-auto">
                        {level >= 2 && <div className="text-center mb-4"><span className={`inline-block px-6 py-2 rounded-full font-bold text-xl text-white ${level === 2 ? 'bg-purple-500' : level === 3 ? 'bg-orange-500' : 'bg-blue-500'}`}>{level === 2 ? 'â­ ìš”ë¦¬ì‚¬' : level === 3 ? 'ğŸŒŸ ì „ë¬¸ìš”ë¦¬ì‚¬' : 'ğŸ’ ì „ë¬¸ê²½ì˜ì¸'}</span></div>}
                        <motion.div animate={{ rotate: [0, -5, 5, -5, 0] }} transition={{ duration: 0.5, repeat: 2 }} className="text-9xl text-center mb-6">{animal.emoji}</motion.div>
                        <div className="text-center mb-8"><h2 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">{animal.name} ì†ë‹˜ì´ ì˜¤ì…¨ì–´ìš”! ğŸ‰</h2>{animal.type === 'friend' && <p className="text-xl text-gray-500 font-bold">{animal.desc}</p>}</div>
                        <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.5, type: "spring" }} className="bg-yellow-100 border-4 border-yellow-300 rounded-2xl p-6 relative mb-8">
                            <div className="text-2xl md:text-3xl text-center text-gray-700 mb-4">{displayOrders.length > 1 ? `"${displayOrders.length}ê°œ ì£¼ë¬¸í• ê²Œìš”!"` : `"${displayOrders[0].name} ì£¼ì„¸ìš”!"`}</div>
                            <div className="flex flex-wrap justify-center gap-6 mb-4">
                                {displayOrders.map((order, i) => (
                                    <div key={i} className="text-center">
                                        <div className="text-6xl mb-2">{order.emoji}</div>
                                        <div className="text-xl font-bold">{order.name}</div>
                                        <div className="text-lg text-green-600">{order.isFreestyle ? 'ê°€ê²©ì€ ë¹„ë°€!' : `${order.price}ì›`}</div>
                                    </div>
                                ))}
                            </div>
                            <div className="absolute -top-4 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[20px] border-r-[20px] border-b-[20px] border-transparent border-b-yellow-300"></div>
                        </motion.div>
                        {!recipe.isFreestyle && <div className="bg-green-50 border-4 border-green-300 rounded-2xl p-6 mb-8"><div className="flex items-center justify-center gap-3"><span className="text-3xl">ğŸ’°</span><span className="text-2xl md:text-3xl font-bold text-green-700">ì´ ê°€ê²©: {totalPrice}ì›</span></div></div>}
                        <motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={onViewRecipe} className="w-full bg-gradient-to-r from-orange-400 to-pink-400 text-white text-2xl md:text-3xl font-bold py-6 rounded-full cute-shadow">{recipe.isFreestyle ? 'ğŸ ìš”ë¦¬í•˜ëŸ¬ ê°€ê¸°!' : 'ğŸ“– ë ˆì‹œí”¼ í™•ì¸í•˜ê¸°!'}</motion.button>
                    </div>
                </motion.div>
            );
        }

// [ìˆ˜ì •ë¨] ë ˆì‹œí”¼ í™”ë©´ (ìš”ë¦¬ ê·¸ë¦¼ ë³´ê³  ì¬ë£Œ ìœ ì¶”í•˜ê¸°)
        function RecipeScreen({ recipe, orders, level, onStartCooking }) {
            if (!recipe) return null;
            
            const [showRecipe, setShowRecipe] = useState(false);
            const isMultipleOrders = orders && orders.length > 1;
            
            // ì£¼ë¬¸ ëª©ë¡ (ì—†ìœ¼ë©´ í˜„ì¬ ë ˆì‹œí”¼ 1ê°œ)
            const currentOrderList = isMultipleOrders ? orders : [recipe];
            
            // ììœ  ìš”ë¦¬(ì¹œêµ¬) ì˜ˆì™¸ ì²˜ë¦¬
            if (recipe.isFreestyle) {
                return (
                    <motion.div
                        initial={{ scale: 0.8, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className="py-8"
                    >
                        <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-3xl mx-auto text-center">
                            <h2 className="text-3xl md:text-4xl font-bold text-purple-600 mb-6">
                                ğŸ ì¹œêµ¬ë¥¼ ìœ„í•œ íŠ¹ë³„ ìš”ë¦¬!
                            </h2>
                            <div className="text-9xl mb-8 animate-bounce-gentle">ğŸ§‘â€ğŸ³</div>
                            <p className="text-2xl text-gray-600 mb-8 leading-relaxed">
                                ì •í•´ì§„ ë ˆì‹œí”¼ê°€ ì—†ì–´ìš”!<br/>
                                ì¹œêµ¬ê°€ ì¢‹ì•„í•˜ëŠ” ì¬ë£Œë¥¼<br/>
                                <strong>ë§ˆìŒëŒ€ë¡œ</strong> ë„£ì–´ë³´ì„¸ìš”!<br/>
                            </p>
                            <motion.button
                                whileHover={{ scale: 1.05 }}
                                whileTap={{ scale: 0.95 }}
                                onClick={onStartCooking}
                                className="w-full bg-gradient-to-r from-green-400 to-blue-400 text-white text-2xl md:text-3xl font-bold py-6 rounded-full cute-shadow"
                            >
                                ğŸ³ ìš”ë¦¬ ì‹œì‘í•˜ê¸°!
                            </motion.button>
                        </div>
                    </motion.div>
                );
            }

            // recipeê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë ˆì‹œí”¼ë¥¼ ë‹¤ì‹œ ì ê¸ˆ ìƒíƒœë¡œ ì´ˆê¸°í™”
            useEffect(() => {
                setShowRecipe(false);
            }, [recipe.id]);

            return (
                <motion.div
                    initial={{ scale: 0.8, opacity: 0 }}
                    animate={{ scale: 1, opacity: 1 }}
                    className="py-8"
                >
                    <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-3xl mx-auto">
                        <h2 className="text-3xl md:text-4xl font-bold text-center text-purple-600 mb-6">
                            {/* ìƒíƒœì— ë”°ë¼ ì œëª© ë³€ê²½ */}
                            {!showRecipe ? "ğŸ¤” ì–´ë–¤ ì¬ë£Œê°€ í•„ìš”í• ê¹Œìš”?" : (isMultipleOrders ? "ğŸ“– ì˜¤ëŠ˜ì˜ ì£¼ë¬¸ì„œ" : `ğŸ“– ${recipe.name} ë ˆì‹œí”¼`)}
                        </h2>

                        {/* showRecipeê°€ falseë©´: ìš”ë¦¬ ê·¸ë¦¼ í¬ê²Œ ë³´ì—¬ì£¼ê¸° (í€´ì¦ˆ ëª¨ë“œ) */}
                        {!showRecipe ? (
                            <motion.div
                                whileHover={{ scale: 1.02 }}
                                whileTap={{ scale: 0.98 }}
                                onClick={() => setShowRecipe(true)}
                                className="bg-gradient-to-br from-yellow-50 to-orange-50 border-4 border-orange-200 rounded-2xl p-8 cursor-pointer text-center relative overflow-hidden"
                            >
                                <div className="absolute top-2 right-2 text-3xl animate-pulse">ğŸ‘†</div>
                                
                                {/* ìš”ë¦¬ ì´ë¯¸ì§€ë“¤ */}
                                <div className="flex justify-center gap-6 mb-6 flex-wrap">
                                    {currentOrderList.map((order, i) => (
                                        <div key={i} className="text-center">
                                            <div className="text-7xl md:text-9xl mb-3 filter drop-shadow-md">{order.emoji}</div>
                                            <div className="text-2xl md:text-3xl font-bold text-gray-800">{order.name}</div>
                                        </div>
                                    ))}
                                </div>

                                <div className="bg-white bg-opacity-60 rounded-xl p-4 inline-block">
                                    <div className="text-xl md:text-2xl font-bold text-orange-600 mb-1">
                                        ì–´ë–¤ ì¬ë£Œê°€ ë“¤ì–´ê°ˆê¹Œìš”?
                                    </div>
                                    <div className="text-base md:text-lg text-gray-500">
                                        (ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ì„œ ì •ë‹µ í™•ì¸!)
                                    </div>
                                </div>
                            </motion.div>
                        ) : (
                            /* showRecipeê°€ trueë©´: ì¬ë£Œ ëª©ë¡ ë³´ì—¬ì£¼ê¸° (ì •ë‹µ ê³µê°œ) */
                            <div className="space-y-6 mb-8">
                                {/* ìƒë‹¨ì— ìš”ë¦¬ ì•„ì´ì½˜ ì‘ê²Œ í‘œì‹œ */}
                                <div className="flex justify-center gap-4 mb-4">
                                    {currentOrderList.map((order, i) => (
                                        <div key={i} className="text-center opacity-50">
                                            <div className="text-4xl">{order.emoji}</div>
                                        </div>
                                    ))}
                                </div>

                                {currentOrderList.map((order, orderIndex) => {
                                    // ì•ˆì „í•˜ê²Œ ë„êµ¬ ê°€ì ¸ì˜¤ê¸°
                                    const orderTool = COOKING_TOOLS[order.cookingTool] || COOKING_TOOLS['pot'];
                                    return (
                                        <motion.div
                                            key={orderIndex}
                                            initial={{ scale: 0.8, opacity: 0 }}
                                            animate={{ scale: 1, opacity: 1 }}
                                            transition={{ delay: orderIndex * 0.2 }}
                                            className="bg-blue-50 border-4 border-blue-200 rounded-2xl p-6"
                                        >
                                            <h3 className="text-xl font-bold text-center text-blue-700 mb-4">
                                                {isMultipleOrders ? `${order.name} ì¬ë£Œ` : "ğŸ¥˜ í•„ìš”í•œ ì¬ë£Œ"}
                                            </h3>
                                            <div className="flex flex-wrap justify-center gap-3 mb-4">
                                                {order.ingredients.map((ingredientId, idx) => {
                                                    const ingredient = GAME_DATA.ingredients[ingredientId];
                                                    return (
                                                        <div key={idx} className="bg-white rounded-xl p-3 cute-shadow">
                                                            <div className="text-4xl text-center mb-1">{ingredient.emoji}</div>
                                                            <div className="text-sm font-bold text-center">{ingredient.name}</div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                            <div className={`${orderTool.color} rounded-xl p-3 text-center mx-auto w-fit`}>
                                                <span className="text-2xl mr-2">{orderTool.emoji}</span>
                                                <span className="font-bold">{orderTool.name}</span>ì— ë„£ìœ¼ì„¸ìš”!
                                            </div>
                                        </motion.div>
                                    );
                                })}
                            </div>
                        )}
                        
                        {/* ë ˆì‹œí”¼ê°€ ê³µê°œë˜ì—ˆì„ ë•Œë§Œ ìš”ë¦¬ ì‹œì‘ ë²„íŠ¼ ë³´ì„ */}
                        {showRecipe && (
                            <motion.button
                                initial={{ y: 20, opacity: 0 }}
                                animate={{ y: 0, opacity: 1 }}
                                whileHover={{ scale: 1.05 }}
                                whileTap={{ scale: 0.95 }}
                                onClick={onStartCooking}
                                className="w-full bg-gradient-to-r from-green-400 to-blue-400 text-white text-2xl md:text-3xl font-bold py-6 rounded-full cute-shadow mt-4"
                            >
                                ğŸ‘¨â€ğŸ³ ìš”ë¦¬ ì‹œì‘í•˜ê¸°!
                            </motion.button>
                        )}
                    </div>
                </motion.div>
            );
        }


// [ìˆ˜ì •ë¨] ì¡°ë¦¬ í™”ë©´ (ëƒ‰ì¥ê³  í¬ê¸° í™•ëŒ€ + ì¬ë£Œ ë²„íŠ¼ ì»´íŒ©íŠ¸í•˜ê²Œ ë³€ê²½)
        function CookingScreen({ recipe, orders, completedOrders, currentOrderIndex, cookingPot, level, stock, onAddIngredient, onRemoveIngredient, onStartCooking }) {
            if (!recipe) return null;
            
            // ë ˆì‹œí”¼ íŒíŠ¸ë¥¼ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€ (ê¸°ë³¸ê°’: false = ì•ˆ ë³´ì—¬ì¤Œ)
            const [showRecipeHint, setShowRecipeHint] = useState(false);
            
            const toolKey = recipe.cookingTool === 'any' ? 'pot' : recipe.cookingTool;
            const tool = COOKING_TOOLS[toolKey] || COOKING_TOOLS['pot'];
            const isMultipleOrders = orders && orders.length > 1;
            const neededIngredients = recipe.isFreestyle ? {} : recipe.ingredients.reduce((acc, id) => { acc[id] = (acc[id] || 0) + 1; return acc; }, {});
            const currentIngredients = cookingPot.reduce((acc, id) => { acc[id] = (acc[id] || 0) + 1; return acc; }, {});
            
            // ìš”ë¦¬ê°€ ë°”ë€” ë•Œë§ˆë‹¤ íŒíŠ¸ë¥¼ ë‹¤ì‹œ ê°€ë¦¼
            useEffect(() => { setShowRecipeHint(false); }, [recipe.id]);

            // ì¹´í…Œê³ ë¦¬ ì •ì˜
            const categories = [
                { label: 'ğŸ¥¦ ì±„ì†Œ', types: ['vegetable'], color: 'bg-green-50 border-2 border-green-100' },
                { label: 'ğŸ ê³¼ì¼', types: ['fruit'], color: 'bg-red-50 border-2 border-red-100' },
                { label: 'ğŸ– ê³ ê¸°/ê³„ë€', types: ['protein'], color: 'bg-orange-50 border-2 border-orange-100' },
                { label: 'ğŸ¥› ê¸°íƒ€', types: ['dairy', 'grain', 'sweets'], color: 'bg-blue-50 border-2 border-blue-100' },
            ];

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full items-start">
                    {/* ì™¼ìª½: ì¬ë£Œ ì„ íƒ (ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜ + ìŠ¤í¬ë¡¤) */}
                    <div className="lg:col-span-2 h-full">
                        {/* ë†’ì´ë¥¼ 750pxë¡œ ëŠ˜ë ¤ì„œ ì˜¤ë¥¸ìª½ í•˜ë‹¨ê³¼ ë§ì¶¤ */}
                        <div className="bg-white rounded-3xl p-4 md:p-6 cute-shadow h-[750px] overflow-y-auto custom-scrollbar">
                            <h2 className="text-2xl md:text-3xl font-bold text-center text-purple-600 mb-4 sticky top-0 bg-white py-2 z-10">
                                ğŸ¥¬ ëƒ‰ì¥ê³ 
                            </h2>
                            
                            {categories.map((cat) => {
                                const catIngredients = Object.values(GAME_DATA.ingredients).filter(ing => 
                                    ing.level <= (level === 1 ? 1 : level) && 
                                    cat.types.includes(ing.category)
                                );

                                if (catIngredients.length === 0) return null;

                                return (
                                    <div key={cat.label} className={`mb-3 p-3 rounded-2xl ${cat.color}`}>
                                        <h3 className="text-lg font-bold text-gray-700 mb-2 ml-1">{cat.label}</h3>
                                        {/* ê·¸ë¦¬ë“œ: ëª¨ë°”ì¼ 4ê°œ, íƒœë¸”ë¦¿/PC 6ê°œë¡œ ì´˜ì´˜í•˜ê²Œ */}
                                        <div className="grid grid-cols-4 md:grid-cols-6 gap-2">
                                            {catIngredients.map((ingredient) => {
                                                const count = stock[ingredient.id] || 0;
                                                const isLow = count <= 2;
                                                const isEmpty = count === 0;
                                                
                                                return (
                                                    <motion.button
                                                        key={ingredient.id}
                                                        whileHover={{ scale: 1.05 }}
                                                        whileTap={{ scale: 0.95 }}
                                                        onClick={() => onAddIngredient(ingredient.id)}
                                                        className={`clickable rounded-xl p-1 md:p-2 shadow-sm transition-all relative flex flex-col items-center ${
                                                            isEmpty ? 'bg-gray-200 opacity-50' : 'bg-white hover:shadow-md'
                                                        }`}
                                                    >
                                                        {/* ì´ëª¨ì§€ í¬ê¸° ì¤„ì„: 3xl */}
                                                        <div className="text-3xl mb-1">{ingredient.emoji}</div>
                                                        {/* í…ìŠ¤íŠ¸ í¬ê¸° ì¤„ì„: xs */}
                                                        <div className="text-xs font-bold text-gray-800 break-keep text-center leading-tight">{ingredient.name}</div>
                                                        
                                                        {/* ì¬ê³  ë±ƒì§€ë„ ì¡°ê¸ˆ ì‘ê²Œ ì¡°ì • */}
                                                        <div className={`absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center font-bold text-[10px] border-2 ${
                                                            isEmpty ? 'bg-gray-400 border-gray-500 text-white' : 
                                                            isLow ? 'bg-red-500 border-red-600 text-white animate-pulse' : 
                                                            'bg-white border-green-400 text-green-700'
                                                        }`}>
                                                            {count}
                                                        </div>
                                                    </motion.button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* ì˜¤ë¥¸ìª½: ì¡°ë¦¬ ë„êµ¬ ë° ì •ë³´ */}
                    <div className="space-y-4">
                        {isMultipleOrders && (
                            <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-3xl p-4 cute-shadow">
                                <div className="text-center mb-2"><span className="text-lg font-bold text-purple-700">ğŸ‘‘ ìš”ë¦¬ ì§„í–‰ ìƒí™©</span></div>
                                <div className="flex justify-center gap-3">
                                    {orders.map((order, index) => (
                                        <div key={index} className={`flex flex-col items-center p-2 rounded-xl ${index < currentOrderIndex ? 'bg-green-200' : index === currentOrderIndex ? 'bg-yellow-200 ring-4 ring-yellow-400' : 'bg-gray-200'}`}>
                                            <div className="text-2xl mb-1">{order.emoji}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* ë ˆì‹œí”¼ íŒíŠ¸ */}
                        {!recipe.isFreestyle && (
                            <div className="bg-white rounded-3xl p-4 cute-shadow">
                                <h3 className="text-xl font-bold text-center text-gray-800 mb-2">ğŸ“‹ ë ˆì‹œí”¼</h3>
                                
                                {!showRecipeHint ? (
                                    <motion.button 
                                        whileHover={{ scale: 1.02 }}
                                        whileTap={{ scale: 0.98 }}
                                        onClick={() => setShowRecipeHint(true)}
                                        className="w-full bg-gray-50 border-4 border-gray-200 rounded-2xl p-3 text-center group hover:bg-yellow-50 hover:border-yellow-200 transition-colors"
                                    >
                                        <div className="text-gray-500 text-xs mb-1 font-bold">ë§Œë“¤ì–´ì•¼ í•  ìš”ë¦¬</div>
                                        <div className="text-5xl mb-1 group-hover:scale-110 transition-transform">{recipe.emoji}</div>
                                        <div className="text-lg font-bold text-gray-800 mb-1">{recipe.name}</div>
                                        <div className="text-xs text-blue-500 bg-blue-100 inline-block px-2 py-1 rounded-full animate-pulse">
                                            ì¬ë£Œ ë³´ê¸° (í´ë¦­!)
                                        </div>
                                    </motion.button>
                                ) : (
                                    <div className="space-y-2">
                                        {Object.entries(neededIngredients).map(([id, count]) => {
                                            const ingredient = GAME_DATA.ingredients[id];
                                            const current = currentIngredients[id] || 0;
                                            const isComplete = current === count;
                                            return (
                                                <div key={id} className={`flex items-center justify-between p-2 rounded-xl ${isComplete ? 'bg-green-50' : 'bg-gray-50'}`}>
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-xl">{ingredient.emoji}</span>
                                                        <span className="font-bold text-sm">{ingredient.name}</span>
                                                    </div>
                                                    <span className={`text-lg font-bold ${isComplete ? 'text-green-600' : 'text-gray-600'}`}>
                                                        {current} / {count}
                                                    </span>
                                                </div>
                                            );
                                        })}
                                        <button 
                                            onClick={() => setShowRecipeHint(false)}
                                            className="text-xs text-gray-400 underline w-full text-center mt-1"
                                        >
                                            ìš”ë¦¬ ê·¸ë¦¼ ë³´ê¸°
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        <div className={`${tool.color} rounded-3xl p-6 cute-shadow border-4 border-opacity-50`}>
                            <h3 className="text-2xl font-bold text-center text-gray-800 mb-4">
                                {recipe.isFreestyle ? 'âœ¨ ë§ˆë²•ì˜ ëƒ„ë¹„' : `${tool.emoji} ${tool.name}`}
                            </h3>
                            <div className="min-h-[250px] bg-white bg-opacity-50 rounded-2xl p-4 mb-4">
                                <div className="flex flex-wrap gap-2 justify-center">
                                    <AnimatePresence>
                                        {cookingPot.length === 0 ? (
                                            <div className="text-center text-gray-400 text-lg py-12 w-full">
                                                {recipe.isFreestyle ? 'ì¢‹ì•„í•˜ëŠ” ì¬ë£Œë¥¼ ë„£ì–´ë³´ì„¸ìš”!' : 'ì¬ë£Œë¥¼ ë„£ì–´ì£¼ì„¸ìš”!'}
                                            </div>
                                        ) : (
                                            cookingPot.map((ingredientId, index) => (
                                                <motion.button 
                                                    key={`${ingredientId}-${index}`} 
                                                    initial={{ scale: 0, rotate: -180 }} 
                                                    animate={{ scale: 1, rotate: 0 }} 
                                                    exit={{ scale: 0 }} 
                                                    onClick={() => onRemoveIngredient(index)} 
                                                    className="bg-white rounded-xl p-2 cute-shadow"
                                                >
                                                    <div className="text-3xl">{GAME_DATA.ingredients[ingredientId].emoji}</div>
                                                </motion.button>
                                            ))
                                        )}
                                    </AnimatePresence>
                                </div>
                            </div>
                            <motion.button 
                                whileHover={{ scale: cookingPot.length > 0 ? 1.05 : 1 }} 
                                onClick={onStartCooking} 
                                className={`w-full py-5 rounded-2xl text-2xl font-bold ${cookingPot.length > 0 ? 'bg-gradient-to-r from-orange-400 to-red-400 text-white cute-shadow' : 'bg-gray-300 text-gray-500'}`}
                            >
                                {cookingPot.length > 0 ? 'ğŸ”¥ ìš”ë¦¬í•˜ê¸°!' : 'ì¬ë£Œë¥¼ ë„£ì–´ì£¼ì„¸ìš”'}
                            </motion.button>
                        </div>
                    </div>
                </div>
            );
        }

        function FailedScreen({ failedDish, ingredientCost, onRetry }) {
            if (!failedDish) return null;
            return (
                <motion.div initial={{ scale: 0.5, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="py-12">
                    <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-2xl mx-auto text-center">
                        <div className="text-8xl mb-6">ğŸ˜…</div>
                        <h2 className="text-3xl md:text-4xl font-bold text-orange-600 mb-4">ì•—! ì‹¤íŒ¨í–ˆì–´ìš”!</h2>
                        <motion.div animate={{ scale: [1, 1.1, 1], rotate: [0, -5, 5, 0] }} transition={{ duration: 0.5, repeat: 3 }} className="text-8xl mb-6">ğŸ¤¢</motion.div>
                        <div className="bg-red-50 border-4 border-red-300 rounded-2xl p-6 mb-6">
                            <div className="text-2xl md:text-3xl font-bold text-red-700 mb-4">{failedDish.name}</div>
                            <div className="flex flex-wrap justify-center gap-3 mb-4">
                                {failedDish.ingredients.map((id, index) => {
                                    const ingredient = GAME_DATA.ingredients[id];
                                    return (<div key={index} className="text-4xl">{ingredient.emoji}</div>);
                                })}
                            </div>
                            <div className="text-lg text-red-600">ì´ìƒí•œ ì¡°í•©ì´ì—ìš”! ğŸ˜µ</div>
                        </div>
                        <motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={onRetry} className="bg-gradient-to-r from-blue-400 to-purple-400 text-white text-2xl md:text-3xl font-bold px-12 py-6 rounded-full cute-shadow">ğŸ”„ ë‹¤ì‹œ ë„ì „í•˜ê¸°!</motion.button>
                    </div>
                </motion.div>
            );
        }

        function ServingScreen({ animal, recipe, onFinish }) {
            useEffect(() => {
                setTimeout(() => { SoundSystem.playEating(); }, 500);
                const timer = setTimeout(() => { onFinish(); }, 4000);
                return () => clearTimeout(timer);
            }, []);
            
            const heartVariants = {
                initial: { y: 0, opacity: 0, scale: 0.5 },
                animate: i => ({ y: -100 - Math.random() * 50, opacity: [0, 1, 0], scale: [1, 1.5, 1], transition: { delay: i * 0.3, duration: 2, repeat: Infinity, repeatType: "loop" } })
            };

            return (
                <motion.div initial={{ scale: 0.5, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="py-12">
                    <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-2xl mx-auto text-center relative overflow-hidden">
                        <div className="absolute inset-0 pointer-events-none">
                            {[...Array(5)].map((_, i) => (
                                <motion.div key={i} custom={i} variants={heartVariants} initial="initial" animate="animate" className="absolute text-5xl md:text-6xl" style={{ left: `${20 + Math.random() * 60}%`, top: `${40 + Math.random() * 30}%`, zIndex: 0 }}>
                                    {['ğŸ’–', 'ğŸ’', 'ğŸ¥°', 'ğŸ’—', 'ğŸ˜'][i % 5]}
                                </motion.div>
                            ))}
                        </div>
                        <h2 className="text-3xl md:text-4xl font-bold text-gray-800 mb-6 relative z-10">ğŸ½ï¸ ìš”ë¦¬ ì™„ì„±!</h2>
                        <motion.div animate={{ scale: [1, 1.2, 1], rotate: [0, 5, -5, 0] }} transition={{ duration: 1, repeat: Infinity }} className="text-9xl mb-6 relative z-10">{recipe.emoji}</motion.div>
                        <div className="text-2xl md:text-3xl font-bold text-purple-600 mb-8 relative z-10">{recipe.name}</div>
                        <motion.div animate={{ rotate: [0, -15, 15, -15, 15, 0], scale: [1, 1.1, 1, 1.1, 1] }} transition={{ duration: 0.8, repeat: Infinity, repeatDelay: 0.2 }} className="text-8xl mb-6 relative z-10">{animal.emoji}</motion.div>
                        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} className="text-2xl md:text-3xl text-gray-700 relative z-10 font-bold">"{animal.name}{getJosa(animal.name, 'ì´/ê°€')} ë„ˆë¬´ í–‰ë³µí•´í•´ìš”! ğŸ˜"</motion.div>
                        <div className="mt-8 text-lg text-gray-500 relative z-10">ì ì‹œ í›„ ê³„ì‚° ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤...</div>
                    </div>
                </motion.div>
            );
        }

        function PaymentScreen({ recipe, orders, customerPayment, selectedChange, onSelectMoney, onRemoveMoney, onCheckChange }) {
            const isMultipleOrders = orders && orders.length > 0;
            const currentOrderList = isMultipleOrders ? orders : [recipe];
            const totalPrice = currentOrderList.reduce((sum, r) => sum + r.price, 0);
            const currentMoney = selectedChange.reduce((sum, money) => sum + money.value, 0);
            const canSubmit = currentMoney === totalPrice;
            
            return (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div className="bg-white rounded-3xl p-6 md:p-8 cute-shadow border-4 border-blue-100">
                        <h2 className="text-3xl md:text-4xl font-bold text-center text-blue-600 mb-8">ğŸ§® ì–¼ë§ˆì¼ê¹Œìš”?</h2>
                        <div className="flex flex-wrap justify-center items-center gap-2 md:gap-4 mb-8">
                            {currentOrderList.map((item, index) => (
                                <React.Fragment key={index}>
                                    {index > 0 && <div className="text-3xl md:text-4xl font-bold text-gray-400 animate-pulse">+</div>}
                                    <div className="flex flex-col items-center bg-white border-2 border-gray-200 rounded-2xl p-3 shadow-sm">
                                        <div className="text-5xl md:text-6xl mb-2">{item.emoji}</div>
                                        <div className="text-sm font-bold text-gray-500 mb-1">{item.name}</div>
                                        <div className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold text-lg md:text-xl">{item.price}</div>
                                    </div>
                                </React.Fragment>
                            ))}
                            <div className="text-3xl md:text-4xl font-bold text-gray-400">=</div>
                            <div className={`rounded-2xl p-4 border-4 transition-all duration-500 ${canSubmit ? 'bg-green-100 border-green-400 scale-110' : 'bg-gray-100 border-gray-300'}`}>
                                <div className={`text-4xl md:text-5xl font-bold ${canSubmit ? 'text-green-600' : 'text-gray-400'}`}>{canSubmit ? `${totalPrice}` : '?'}</div>
                            </div>
                        </div>
                        <div className="bg-yellow-50 rounded-xl p-4 text-center border-2 border-yellow-200">
                            <p className="text-lg font-bold text-yellow-800">ìš”ë¦¬ ê°€ê²©ì„ ëª¨ë‘ ë”í•´ì„œ<br/><span className="text-blue-600 text-2xl">ë¬¼ìŒí‘œ(?)</span>ë¥¼ ë§ì¶°ë³´ì„¸ìš”!</p>
                        </div>
                    </div>
                    <div className="space-y-6">
                        <div className="bg-white rounded-3xl p-6 cute-shadow">
                            <h3 className="text-2xl font-bold text-center text-gray-800 mb-4">ğŸ’´ ì§€ê°‘ì—ì„œ ëˆ êº¼ë‚´ê¸°</h3>
                            <div className="grid grid-cols-3 gap-4 mb-6">
                                {GAME_DATA.money.map((money, index) => (
                                    <motion.button key={index} whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={() => onSelectMoney(money)} className="clickable bg-gradient-to-br from-green-100 to-green-200 border-b-4 border-green-300 rounded-2xl p-4 active:border-b-0 active:translate-y-1 transition-all">
                                        <div className="text-4xl mb-2">{money.emoji}</div>
                                        <div className="text-lg font-bold text-green-800">{money.value}ì›</div>
                                    </motion.button>
                                ))}
                            </div>
                        </div>
                        <div className="bg-white rounded-3xl p-6 cute-shadow">
                            <h3 className="text-2xl font-bold text-center text-gray-800 mb-4">âœ‹ ë‚´ê°€ ì˜¬ë¦° ëˆ</h3>
                            <div className="min-h-[120px] bg-gray-50 rounded-2xl p-4 mb-4 border-2 border-dashed border-gray-300">
                                <div className="flex flex-wrap gap-2 justify-center">
                                    <AnimatePresence>
                                        {selectedChange.length === 0 ? (
                                            <div className="text-center text-gray-400 py-8 w-full flex flex-col items-center"><span className="text-4xl mb-2">ğŸ‘†</span>ìœ„ì—ì„œ ëˆì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</div>
                                        ) : (
                                            selectedChange.map((money, index) => (
                                                <motion.button key={`${money.value}-${index}`} initial={{ scale: 0, y: 20 }} animate={{ scale: 1, y: 0 }} exit={{ scale: 0 }} whileHover={{ scale: 1.1 }} onClick={() => onRemoveMoney(index)} className="bg-white border border-gray-200 rounded-xl p-2 shadow-sm cursor-pointer hover:bg-red-50">
                                                    <div className="text-2xl">{money.emoji}</div>
                                                    <div className="text-xs font-bold">{money.value}</div>
                                                </motion.button>
                                            ))
                                        )}
                                    </AnimatePresence>
                                </div>
                            </div>
                            <div className={`rounded-xl p-4 mb-4 transition-colors duration-300 ${canSubmit ? 'bg-green-100' : 'bg-blue-50'}`}>
                                <div className="flex justify-between items-center">
                                    <span className="font-bold text-gray-600">ì§€ê¸ˆ í•©ê³„:</span>
                                    <span className={`text-3xl font-bold ${canSubmit ? 'text-green-600' : currentMoney > totalPrice ? 'text-red-500' : 'text-blue-600'}`}>{currentMoney}ì›</span>
                                </div>
                                {!canSubmit && currentMoney > totalPrice && (<div className="text-center text-red-500 text-sm font-bold mt-2 animate-bounce">ëˆì´ ë„ˆë¬´ ë§ì•„ìš”! ë™ì „ì„ ëˆŒëŸ¬ì„œ ë¹¼ì£¼ì„¸ìš”.</div>)}
                            </div>
                            <motion.button whileHover={{ scale: canSubmit ? 1.05 : 1 }} whileTap={{ scale: canSubmit ? 0.95 : 1 }} onClick={onCheckChange} disabled={!canSubmit} className={`w-full py-5 rounded-2xl text-xl font-bold transition-all ${canSubmit ? 'bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg cursor-pointer animate-pulse' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}>
                                {canSubmit ? 'âœ… ëˆ ë‚´ê¸°!' : `ê°€ê²©ì„ ë§ì¶°ì£¼ì„¸ìš”`}
                            </motion.button>
                        </div>
                    </div>
                </div>
            );
        }

// [ìˆ˜ì •ë¨] ë§ˆíŠ¸ í™”ë©´ (ì•„ì´íŒ¨ë“œ ìŠ¤í¬ë¡¤ ë²„ê·¸ ìˆ˜ì •)
        function MarketScreen({ stock, score, cart, setCart, onCheckout, onBack }) {
            const totalPrice = Object.entries(cart).reduce((sum, [_, qty]) => sum + (qty * 100), 0);

            const updateCart = (id, delta) => {
                const currentQty = cart[id] || 0;
                const newQty = Math.max(0, currentQty + delta);
                if (newQty === 0) {
                    const newCart = { ...cart };
                    delete newCart[id];
                    setCart(newCart);
                } else {
                    setCart({ ...cart, [id]: newQty });
                }
                SoundSystem.playPop();
            };

            return (
                <motion.div 
                    initial={{ y: 50, opacity: 0 }} 
                    animate={{ y: 0, opacity: 1 }} 
                    className="py-4 h-full"
                >
                    <div className="bg-white rounded-3xl p-6 md:p-8 cute-shadow max-w-4xl mx-auto flex flex-col h-full max-h-[90vh]">
                        {/* 1. ìƒë‹¨ í—¤ë” (ê³ ì •) */}
                        <div className="flex justify-between items-center mb-4 flex-none">
                            <button onClick={onBack} className="bg-gray-200 text-gray-700 px-4 py-2 rounded-xl font-bold">â¬… ë’¤ë¡œê°€ê¸°</button>
                            <h2 className="text-3xl font-bold text-green-700">ğŸ›’ ì‹±ì‹± ë§ˆíŠ¸</h2>
                            <div className="text-2xl font-bold text-orange-600">ë‚´ ëˆ: {score}ì›</div>
                        </div>

                        {/* 2. ìŠ¤í¬ë¡¤ ì˜ì—­ (ì—¬ê¸°ê°€ ì¤‘ìš”!) */}
                        {/* flex-1ë¡œ ë‚¨ì€ ê³µê°„ì„ ë‹¤ ì°¨ì§€í•˜ê²Œ í•˜ê³ , overflow-y-autoë¡œ ìŠ¤í¬ë¡¤ ìƒì„± */}
                        {/* style={{ WebkitOverflowScrolling: 'touch' }} ê°€ ì•„ì´íŒ¨ë“œ ìŠ¤í¬ë¡¤ í•µì‹¬ */}
                        <div 
                            className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 overflow-y-auto custom-scrollbar flex-1 p-2"
                            style={{ WebkitOverflowScrolling: 'touch' }}
                        >
                            {Object.values(GAME_DATA.ingredients).map((ing) => (
                                <div key={ing.id} className="bg-gray-50 border-2 border-gray-200 rounded-xl p-4 flex flex-col items-center shadow-sm">
                                    <div className="text-4xl mb-2">{ing.emoji}</div>
                                    <div className="font-bold text-gray-800">{ing.name}</div>
                                    <div className="text-sm text-gray-500 mb-2">í˜„ì¬: {stock[ing.id]}ê°œ</div>
                                    <div className="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-lg text-sm font-bold mb-3">1ê°œ 100ì›</div>
                                    
                                    <div className="flex items-center gap-3">
                                        <button onClick={() => updateCart(ing.id, -1)} className="w-10 h-10 bg-red-100 text-red-600 rounded-full font-bold text-xl active:scale-90 transition-transform">-</button>
                                        <span className="text-xl font-bold w-6 text-center">{cart[ing.id] || 0}</span>
                                        <button onClick={() => updateCart(ing.id, 1)} className="w-10 h-10 bg-blue-100 text-blue-600 rounded-full font-bold text-xl active:scale-90 transition-transform">+</button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* 3. í•˜ë‹¨ ê³„ì‚° ë²„íŠ¼ (ê³ ì •) */}
                        <div className="bg-green-50 border-4 border-green-200 rounded-2xl p-6 flex flex-col md:flex-row justify-between items-center gap-4 flex-none">
                            <div className="text-center md:text-left">
                                <div className="text-gray-600 text-lg">ì¥ë°”êµ¬ë‹ˆ í•©ê³„</div>
                                <div className="text-4xl font-bold text-green-700">{totalPrice}ì›</div>
                            </div>
                            <button 
                                onClick={() => {
                                    if (totalPrice === 0) return alert("ì‚´ ë¬¼ê±´ì„ ë‹´ì•„ì£¼ì„¸ìš”!");
                                    if (totalPrice > score) return alert("ëˆì´ ë¶€ì¡±í•´ìš”!");
                                    onCheckout(totalPrice);
                                }}
                                disabled={totalPrice === 0}
                                className={`px-8 py-4 rounded-xl text-2xl font-bold text-white shadow-lg w-full md:w-auto ${totalPrice > 0 ? 'bg-green-500 hover:bg-green-600 active:scale-95 transition-transform' : 'bg-gray-400'}`}
                            >
                                âœ… ê³„ì‚°í•˜ëŸ¬ ê°€ê¸°
                            </button>
                        </div>
                    </div>
                </motion.div>
            );
        }

        function ExpenseScreen({ amount, selectedChange, onSelectMoney, onRemoveMoney, onCheckExpense }) {
            const currentMoney = selectedChange.reduce((sum, money) => sum + money.value, 0);
            const canPay = currentMoney === amount;
            return (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div className="bg-white rounded-3xl p-6 md:p-8 cute-shadow">
                        <h2 className="text-3xl font-bold text-center text-blue-600 mb-6">ğŸ’¸ ê³„ì‚°ëŒ€</h2>
                        <div className="text-center mb-8"><div className="text-8xl mb-4">ğŸª</div><p className="text-2xl text-gray-700">ì´ <span className="text-blue-600 font-bold">{amount}ì›</span> ì…ë‹ˆë‹¤!</p></div>
                        <div className="bg-yellow-50 rounded-xl p-4 text-center border-2 border-yellow-200"><p className="text-lg font-bold text-yellow-800">ì§€ê°‘ì—ì„œ ëˆì„ êº¼ë‚´<br/><span className="text-blue-600 text-2xl">{amount}ì›</span>ì„ ë‚´ì£¼ì„¸ìš”.</p></div>
                    </div>
                    <div className="space-y-6">
                        <div className="bg-white rounded-3xl p-6 cute-shadow">
                            <h3 className="text-2xl font-bold text-center text-gray-800 mb-4">ğŸ’´ ë‚´ ì§€ê°‘</h3>
                            <div className="grid grid-cols-3 gap-4">
                                {GAME_DATA.money.map((money, index) => (
                                    <motion.button key={index} whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={() => onSelectMoney(money)} className="bg-green-100 border-b-4 border-green-300 rounded-2xl p-3 active:border-b-0"><div className="text-3xl mb-1">{money.emoji}</div><div className="text-sm font-bold">{money.value}</div></motion.button>
                                ))}
                            </div>
                        </div>
                        <div className="bg-white rounded-3xl p-6 cute-shadow">
                            <h3 className="text-2xl font-bold text-center text-gray-800 mb-4">âœ‹ ë‚¼ ëˆ</h3>
                            <div className="min-h-[100px] bg-gray-50 rounded-2xl p-4 mb-4 border-2 border-dashed border-gray-300 flex flex-wrap gap-2 justify-center">
                                {selectedChange.map((money, index) => (
                                    <motion.button key={index} initial={{ scale: 0 }} animate={{ scale: 1 }} onClick={() => onRemoveMoney(index)} className="bg-white border rounded-xl p-2 shadow-sm"><div className="text-xl">{money.emoji}</div><div className="text-xs font-bold">{money.value}</div></motion.button>
                                ))}
                            </div>
                            <div className="flex justify-between items-center mb-4 px-2"><span className="font-bold text-gray-600">í˜„ì¬ í•©ê³„:</span><span className={`text-2xl font-bold ${canPay ? 'text-green-600' : 'text-red-500'}`}>{currentMoney}ì›</span></div>
                            <motion.button whileHover={{ scale: canPay ? 1.05 : 1 }} onClick={onCheckExpense} disabled={!canPay} className={`w-full py-4 rounded-2xl text-xl font-bold text-white ${canPay ? 'bg-blue-500 shadow-lg' : 'bg-gray-300'}`}>{canPay ? 'âœ… ê³„ì‚°í•˜ê¸°' : 'ê¸ˆì•¡ì„ ë§ì¶°ì£¼ì„¸ìš”'}</motion.button>
                        </div>
                    </div>
                </div>
            );
        }

        function EmergencyModal({ item, onBuy, onCancel }) {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <motion.div initial={{ scale: 0.5 }} animate={{ scale: 1 }} className="bg-white rounded-3xl p-8 max-w-sm w-full text-center m-4">
                        <div className="text-6xl mb-4">ğŸš¨</div>
                        <h3 className="text-2xl font-bold text-red-600 mb-2">ì¬ë£Œê°€ ì—†ì–´ìš”!</h3>
                        <div className="text-gray-700 mb-6"><span className="text-4xl">{item.emoji}</span><br/><strong>{item.name}</strong>ê°€ ë‹¤ ë–¨ì–´ì¡Œì–´ìš”.<br/>í€µì„œë¹„ìŠ¤ë¡œ ê¸‰í•˜ê²Œ ì£¼ë¬¸í• ê¹Œìš”?</div>
                        <div className="bg-yellow-100 p-3 rounded-xl mb-6 font-bold text-yellow-800">ë¹„ìš©: 200ì› (2ë°° ë¹„ì‹¸ìš”!)</div>
                        <div className="flex gap-3">
                            <button onClick={onCancel} className="flex-1 bg-gray-200 py-3 rounded-xl font-bold text-gray-600">ì·¨ì†Œ</button>
                            <button onClick={onBuy} className="flex-1 bg-red-500 text-white py-3 rounded-xl font-bold hover:bg-red-600">ğŸš€ 200ì›ì— êµ¬ë§¤</button>
                        </div>
                    </motion.div>
                </div>
            );
        }

        function LevelUpScreen({ currentLevel, newLevel, onContinue }) {
            const levelInfo = {
                2: { icon: 'ğŸ‘‘', name: 'ìš”ë¦¬ì‚¬', color: 'text-purple-600', bgColor: 'from-purple-100 to-pink-100', requirement: '3,000ì›', features: [{ emoji: 'ğŸœ', text: 'ìƒˆë¡œìš´ ìš”ë¦¬ 5ì¢… ì¶”ê°€!' }, { emoji: 'ğŸ¥’', text: 'ìƒˆë¡œìš´ ì¬ë£Œ 5ì¢… ì¶”ê°€!' }, { emoji: 'ğŸ‘¥', text: 'ì†ë‹˜ì´ 2ê°œì”© ì£¼ë¬¸í•´ìš”!' }, { emoji: 'ğŸ”„', text: '2ê°œ ìš”ë¦¬ë¥¼ ìˆœì„œëŒ€ë¡œ ë§Œë“¤ì–´ìš”!' }, { emoji: 'ğŸ§®', text: 'ê³„ì‚°ì´ ë” ë³µì¡í•´ì ¸ìš”!' }] },
                3: { icon: 'ğŸŒŸ', name: 'ì „ë¬¸ìš”ë¦¬ì‚¬', color: 'text-orange-600', bgColor: 'from-orange-100 to-red-100', requirement: '10,000ì›', features: [{ emoji: 'ğŸ', text: 'ìµœê³ ê¸‰ ìš”ë¦¬ 6ì¢… ì¶”ê°€!' }, { emoji: 'ğŸ¦', text: 'í”„ë¦¬ë¯¸ì—„ ì¬ë£Œ 6ì¢… ì¶”ê°€!' }, { emoji: 'ğŸª²', text: 'ê³¤ì¶© ì†ë‹˜ 3ì¢… ë“±ì¥!' }, { emoji: 'ğŸ‘¥ğŸ‘¥ğŸ‘¥', text: 'ì†ë‹˜ì´ 3ê°œì”© ì£¼ë¬¸í•´ìš”!' }, { emoji: 'ğŸ”„ğŸ”„ğŸ”„', text: '3ê°œ ìš”ë¦¬ë¥¼ ìˆœì„œëŒ€ë¡œ ë§Œë“¤ì–´ìš”!' }, { emoji: 'ğŸ§®ğŸ’°', text: 'ê³„ì‚°ì´ ë§¤ìš° ë³µì¡í•´ì ¸ìš”!' }] },
                4: { icon: 'ğŸ’', name: 'ì „ë¬¸ê²½ì˜ì¸', color: 'text-blue-600', bgColor: 'from-blue-100 to-cyan-100', requirement: '50,000ì›', features: [{ emoji: 'ğŸ†', text: 'ë ˆìŠ¤í† ë‘ì„ ì™„ì „íˆ ë§ˆìŠ¤í„°í–ˆì–´ìš”!' }, { emoji: 'ğŸ’°', text: 'ì—„ì²­ë‚œ ìˆ˜ìµì„ ë‹¬ì„±í–ˆì–´ìš”!' }, { emoji: 'â­', text: 'ìµœê³ ì˜ ìš”ë¦¬ì‚¬ê°€ ë˜ì…¨ì–´ìš”!' }, { emoji: 'ğŸ‰', text: 'ì¶•í•˜í•©ë‹ˆë‹¤! ê²Œì„ì„ ê³„ì†í•˜ì„¸ìš”!' }] }
            };
            const info = levelInfo[newLevel];
            return (
                <motion.div initial={{ scale: 0.5, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="py-12">
                    <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-2xl mx-auto text-center">
                        <motion.div animate={{ rotate: [0, 360], scale: [1, 1.2, 1] }} transition={{ duration: 2, repeat: Infinity }} className="text-9xl mb-6">â­</motion.div>
                        <h2 className="text-4xl md:text-6xl font-bold text-yellow-600 mb-4">ìŠ¹ì§„í•©ë‹ˆë‹¤! ğŸŠ</h2>
                        <div className="text-8xl mb-6">{info.icon}</div>
                        <p className="text-2xl md:text-3xl text-gray-700 mb-6">{info.requirement} ë‹¬ì„±!<br/><span className={`text-4xl font-bold ${info.color}`}>{info.name}</span>ë¡œ ìŠ¹ì§„! ğŸš€</p>
                        <div className={`bg-gradient-to-r ${info.bgColor} rounded-2xl p-6 mb-8`}>
                            <div className="text-xl font-bold text-gray-700 mb-4">{info.icon} {info.name} íŠ¹ì§•</div>
                            <div className="space-y-2 text-left">
                                {info.features.map((feature, index) => (
                                    <div key={index} className="flex items-center gap-2"><span className="text-2xl">{feature.emoji}</span><span className="text-lg">{feature.text}</span></div>
                                ))}
                            </div>
                        </div>
                        <motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={onContinue} className="bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-2xl md:text-3xl font-bold px-12 py-6 rounded-full cute-shadow">ğŸ® {info.name}ë¡œ ì‹œì‘í•˜ê¸°!</motion.button>
                    </div>
                </motion.div>
            );
        }

        function ResultScreen({ animal, recipe, orders, score, onNextRound }) {
            const totalEarned = orders ? orders.reduce((sum, r) => sum + r.price, 0) : recipe.price;
            return (
                <motion.div initial={{ scale: 0.5, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="py-12">
                    <div className="bg-white rounded-3xl p-8 md:p-12 cute-shadow max-w-2xl mx-auto text-center">
                        <div className="text-8xl mb-6">ğŸ‰</div>
                        <h2 className="text-4xl md:text-5xl font-bold text-gray-800 mb-4">ì™„ë²½í•´ìš”!</h2>
                        <motion.div animate={{ rotate: [0, -10, 10, -10, 10, 0], scale: [1, 1.1, 1] }} transition={{ duration: 1, repeat: Infinity, repeatDelay: 1 }} className="text-9xl mb-6">{animal.emoji}</motion.div>
                        <p className="text-2xl md:text-3xl text-gray-600 mb-6">{animal.name}{getJosa(animal.name, 'ì´/ê°€')} ì •ë§ ë§›ìˆê²Œ ë¨¹ì—ˆì–´ìš”!<br/>ê±°ìŠ¤ë¦„ëˆë„ ì •í™•í•˜ê²Œ ê³„ì‚°í–ˆì–´ìš”! ğŸ’¯</p>
                        {orders && orders.length > 1 && (
                            <div className="bg-purple-50 border-4 border-purple-300 rounded-2xl p-4 mb-6">
                                <div className="text-lg font-bold text-purple-700 mb-2">ì™„ì„±í•œ ìš”ë¦¬</div>
                                <div className="flex justify-center gap-4">
                                    {orders.map((order, i) => (
                                        <div key={i} className="text-center"><div className="text-4xl">{order.emoji}</div><div className="text-sm font-bold">{order.name}</div><div className="text-xs text-purple-600">{order.price}ì›</div></div>
                                    ))}
                                </div>
                            </div>
                        )}
                        <div className="bg-gradient-to-r from-yellow-200 to-orange-200 rounded-2xl p-6 mb-8"><div className="text-xl font-bold text-gray-700 mb-2">ì´ë²ˆì— ë²ˆ ëˆ</div><div className="text-5xl font-bold text-orange-600">ğŸ’° {totalEarned}ì›</div></div>
                        <div className="bg-gradient-to-r from-green-200 to-blue-200 rounded-2xl p-6 mb-8"><div className="text-xl font-bold text-gray-700 mb-2">ì´ ìˆ˜ìµ</div><div className="text-5xl font-bold text-green-600">ğŸ’µ {score}ì›</div></div>
                        <motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={onNextRound} className="bg-gradient-to-r from-purple-400 to-pink-400 text-white text-2xl md:text-3xl font-bold px-12 py-6 rounded-full cute-shadow">ğŸ® ë‹¤ìŒ ì†ë‹˜ ë§ì´í•˜ê¸°!</motion.button>
                    </div>
                </motion.div>
            );
        }

        function FeedbackMessage({ message }) {
            return (
                <motion.div initial={{ y: -100, opacity: 0 }} animate={{ y: 0, opacity: 1 }} exit={{ y: -100, opacity: 0 }} className="fixed top-24 left-1/2 transform -translate-x-1/2 z-50">
                    <div className="bg-orange-500 text-white text-xl md:text-2xl font-bold px-8 py-4 rounded-full cute-shadow">{message}</div>
                </motion.div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RestaurantGame />);
    </script>
</body>
</html>
